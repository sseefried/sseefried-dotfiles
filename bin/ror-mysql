#!/usr/bin/env ruby

require 'rubygems'
require 'yaml'
require 'active_support'

if ARGV.length < 1
  puts "Usage: $0 <rails environment>"
  exit
end

def find_database_yml
  found = File.exists?("config/database.yml")
  until Dir.pwd == "/" || found
    Dir.chdir("..")
    found = File.exists?("config/database.yml")
  end
  if found
    YAML.load_file("config/database.yml")
  else
    nil
  end
end

db = find_database_yml
if db 
  cfg = db[ARGV[0]]
  if !cfg.nil?
    cmd = "mysql -h #{cfg['host']} -u #{cfg['username']} -p#{cfg['password']} #{cfg['database']}"
    system(cmd)
  else
    puts "Could not find database configuration '#{ARGV[0]}'."
    puts "Available configurations are: #{db.keys.to_sentence}"
    exit 
  end
else
  puts "Could not find 'database.yml'. Did you call this in a "
  puts "Rails project or subdirectory of that project?"
end
