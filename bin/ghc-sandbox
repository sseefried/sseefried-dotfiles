#!/usr/bin/env ruby

#
# A GHC that is aware that it's in a Sandbox and will operate accordinging
#

require File.join(File.dirname(__FILE__), "shell_helpers")

dir = ShellHelpers::try_in_dir_or_parents { File.exist?(".cabal-sandbox") }

if dir
  fs = Dir.glob("#{dir}/.cabal-sandbox/*-packages.conf.d")
  if fs.size > 0
    package_conf = fs.first
    system("ghc -package-db #{package_conf} #{ARGV.join(" ")}")
    exit $?.exitstatus # Exit with same exit status as GHC
  end
end

# Fall through

system("ghc #{ARGV.join(" ")}")